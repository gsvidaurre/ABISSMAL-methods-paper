---
title: "Interobserver reliability"
author: "Grace Smith-Vidaurre"
date: "2024-07-18"
output: html_document
---

Purpose: Perform a validation analysis of automatically scored behaviors (e.g. behavioral inferences) obtained by ABISSMAL. The computational analyses available in ABISSMAL facilitate integrating data across movement sensors to derive coarse-grained behavioral inferences. Here, we will validate those behavioral inferences for a subsample of the full set of videos used in the methods manuscript, using a baseline dataset obtained by manual video scoring to obtain coarse-grained behavioral states for adult birds and juveniles. The current plan for this validation analysis includes 1) assessing whether the automated and manual scoring return similar levels of overall activity per unique recording event, 2) whether the automated and manual scoring return similar levels of overall activity per behavioral state in each unique recording event, 3) the degree to which the timestamps for these automated and manual scores agree with one another (this will be a bit tricky given that some of the movement sensors will detect movement before the videos), 4) we can also iterate over parameter combinations for the automated scoring to ask how these decisions influence ageement with the manual dataset.

The manually scored data needs to be concatenated and checked prior to running the final validation analysis. Also, Summer noticed some video recording events had videos switched in order, so we have to pre-process the manually scored dataset to fix these issues for the videos she caught that had this issue.

Finally, the validation analysis will be planned out and run with a random subsample of the videos used for this analysis.

```{r package and paths, warning = FALSE, message = FALSE}

# Clean the global environment
rm(list = ls())

X <- c("tidyverse", "pbapply", "data.table")

invisible(lapply(X, library, character.only = TRUE))

# Path to the BORIS spreadsheets
path <- "~/Desktop/ABISSMAL_validation_data/Manual_Scoring_Results"

```

Read in all of the spreadsheets and concatenate them into a single data frame.
```{r}

# Print all of the directories with video files
files <- list.files(path, pattern = ".csv$", full.names = TRUE)
# head(files)
length(files)

# Read in the very first spreadsheet and save the column names for the loop below (to organize data across all spreadsheets)
keep_nms <- names(read.csv(files[1]))
keep_nms

# i <- 1 # testing
combined_events <- data.table::rbindlist(pblapply(1:length(files), function(i){

  read.csv(files[i])

}))

glimpse(combined_events)
View(combined_events)

```

Next steps:

1. We need to do data wrangling to make this data frame of BORIS scoring winder (each row should be a behavioral state scored for a unique subject) to match the data structure returned by the ABISSMAL computational analyses

2. We need to choose a subsample of these videos to develop the validation analysis pipeline

3. Start writing out the steps of the validation analysis, run these with the subsample of videos chosen above

4. Data pre-processing of the switched recording events that Summer identified

5. Run the full validation analysis pipeline with all 4045 video recording events
